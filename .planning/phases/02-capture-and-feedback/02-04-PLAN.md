---
phase: 02-capture-feedback
plan: 04
type: execute
wave: 2
depends_on: ["02-02"]
files_modified:
  - frontend/components/TaskCard.tsx
  - frontend/app/board/page.tsx
  - frontend/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "Task completion triggers confetti celebration"
    - "Checkbox click has satisfying animation"
    - "Visual feedback is immediate (<200ms perceived lag)"
    - "Confetti respects reduced-motion preference"
  artifacts:
    - path: "frontend/components/TaskCard.tsx"
      provides: "Enhanced task card with completion celebration"
      contains: "triggerTaskComplete"
    - path: "frontend/app/board/page.tsx"
      provides: "Board with celebration on task completion"
      contains: "triggerTaskComplete"
  key_links:
    - from: "TaskCard.tsx"
      to: "triggerTaskComplete"
      via: "import"
      pattern: "import.*triggerTaskComplete.*from"
    - from: "TaskCard completion handler"
      to: "confetti"
      via: "function call"
      pattern: "triggerTaskComplete\\(\\)"
---

<objective>
Add dopamine-triggering completion celebrations to task cards and board, making task completion feel rewarding and satisfying for ADHD users.

Purpose: ADHD brains respond to immediate rewards. When a user completes a task, the visual celebration creates a dopamine hit that reinforces the behavior and motivates continued productivity. The animation must be immediate (<200ms) to feel connected to the action.

Output: Task completion anywhere in the app triggers confetti animation with satisfying checkbox animation.
</objective>

<execution_context>
@/home/rbrown/.claude/get-shit-done/workflows/execute-plan.md
@/home/rbrown/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-capture--and--feedback/02-RESEARCH.md

# Confetti utility from Plan 02
@frontend/lib/confetti.ts

# Existing components to modify
@frontend/components/TaskCard.tsx
@frontend/app/board/page.tsx
@frontend/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add completion celebration to TaskCard</name>
  <files>frontend/components/TaskCard.tsx</files>
  <action>
Enhance TaskCard component with completion celebration:

1. Import triggerTaskComplete from '@/lib/confetti'
2. Find the completion handler (where task status changes to 'done')
3. Add confetti trigger BEFORE the API call (optimistic feedback)
4. Add Framer Motion scale animation to checkbox on click

Implementation approach:

1. Locate the checkbox or completion button in TaskCard
2. In its onClick handler, before calling updateTask:
   ```typescript
   import { triggerTaskComplete } from '@/lib/confetti'

   // In completion handler:
   const handleComplete = async () => {
     // Immediate celebration (optimistic)
     triggerTaskComplete()

     // Then update backend
     try {
       await updateTask(task.id, { status: 'done' })
       // ... existing logic
     } catch (error) {
       // Error handling - confetti already fired, that's OK
     }
   }
   ```

3. Add subtle scale animation to checkbox:
   ```typescript
   <motion.button
     whileTap={{ scale: 0.9 }}
     onClick={handleComplete}
     className="..."
   >
     <CheckIcon />
   </motion.button>
   ```

Note: If TaskCard doesn't have a direct completion handler, find where status changes to 'done' and add the celebration there.
  </action>
  <verify>
1. `npm run build` passes
2. Confetti imported: `grep -r "triggerTaskComplete" frontend/components/TaskCard.tsx`
3. Has animation: `grep -r "whileTap\|motion" frontend/components/TaskCard.tsx`
  </verify>
  <done>
TaskCard triggers confetti on task completion with satisfying tap animation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add completion celebration to Board page</name>
  <files>frontend/app/board/page.tsx</files>
  <action>
Add completion celebration to the board page's task completion flow:

1. Import triggerTaskComplete from '@/lib/confetti'
2. Find where tasks are marked as 'done' (either via drag-drop to done column or checkbox)
3. Add confetti trigger on completion

The board likely has drag-drop handling where a task dropped in the "done" column triggers completion. Find this handler and add:

```typescript
import { triggerTaskComplete } from '@/lib/confetti'

// In the drag-drop onDragEnd handler:
if (destination.droppableId === 'done' && source.droppableId !== 'done') {
  // Task just moved to done column
  triggerTaskComplete()
}

// Or in direct completion handler:
const handleTaskComplete = async (taskId: string) => {
  triggerTaskComplete() // Optimistic celebration
  await updateTask(taskId, { status: 'done' })
}
```

Make sure confetti fires BEFORE the async API call for immediate feedback.
  </action>
  <verify>
1. `npm run build` passes
2. Confetti imported: `grep -r "triggerTaskComplete" frontend/app/board/page.tsx`
  </verify>
  <done>
Board page triggers confetti when task is completed (via drag-drop to done column or direct completion).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete capture and feedback system for Phase 2:
- Global quick capture (Cmd/Ctrl+N, FAB, modal with voice)
- Draft preservation across navigation
- Confetti on task creation and completion
- Satisfying animations throughout
  </what-built>
  <how-to-verify>
1. Start dev server: `cd frontend && npm run dev`
2. Open http://localhost:3000

**Quick Capture Flow (<5 seconds goal):**
3. Press Cmd/Ctrl+N - modal should open instantly
4. Type "Test task from quick capture"
5. Press Enter - task should be created, confetti should appear
6. Check task list - new task should appear

**FAB Access:**
7. Click the floating + button (bottom-right)
8. Modal should open
9. Create another task - confetti should appear

**Voice Input (Chrome/Edge only):**
10. Open modal, click microphone button
11. Speak "Voice test task"
12. Text should appear in input
13. Submit - task should be created

**Draft Preservation:**
14. Open modal, type "Draft test"
15. Close modal without submitting
16. Reopen modal - "Draft test" should still be there

**Task Completion Celebration:**
17. Go to task list or board
18. Complete any task (checkbox or drag to done)
19. Confetti should appear

**Accessibility:**
20. Check FAB has aria-label (inspect element)
21. Enable "Reduce Motion" in system settings
22. Complete a task - confetti should NOT appear
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 2, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Full build passes: `cd frontend && npm run build`
2. TaskCard has confetti: `grep -r "triggerTaskComplete" frontend/components/TaskCard.tsx`
3. Board has confetti: `grep -r "triggerTaskComplete" frontend/app/board/page.tsx`
4. Manual testing per checkpoint above
</verification>

<success_criteria>
- Task completion on TaskCard triggers confetti
- Task completion on board (drag to done) triggers confetti
- Confetti respects reduced-motion preference
- Checkbox has satisfying tap animation
- All celebrations feel immediate (<200ms perceived)
- Human verification confirms full capture+feedback flow works
</success_criteria>

<output>
After completion, create `.planning/phases/02-capture--and--feedback/02-04-SUMMARY.md`
</output>

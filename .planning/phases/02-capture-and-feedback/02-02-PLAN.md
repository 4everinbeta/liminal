---
phase: 02-capture-feedback
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/package-lock.json
  - frontend/lib/confetti.ts
  - frontend/lib/hooks/useKeyboardShortcut.ts
autonomous: true

must_haves:
  truths:
    - "Confetti animation can be triggered programmatically"
    - "Keyboard shortcut Cmd/Ctrl+N can trigger actions globally"
    - "Confetti respects reduced-motion preference"
  artifacts:
    - path: "frontend/lib/confetti.ts"
      provides: "Confetti trigger utility with preset configurations"
      exports: ["triggerConfetti", "triggerTaskComplete"]
    - path: "frontend/lib/hooks/useKeyboardShortcut.ts"
      provides: "Global keyboard shortcut hook"
      exports: ["useKeyboardShortcut"]
  key_links:
    - from: "triggerConfetti"
      to: "canvas-confetti"
      via: "import"
      pattern: "import confetti from 'canvas-confetti'"
    - from: "useKeyboardShortcut"
      to: "document.addEventListener"
      via: "keydown event"
      pattern: "addEventListener.*keydown"
---

<objective>
Install dependencies and create utilities for confetti celebrations and global keyboard shortcuts that enable instant task capture and dopamine-triggering feedback.

Purpose: canvas-confetti provides GPU-accelerated celebration animations for task completion. react-hotkeys-hook is available but we'll create a simpler custom hook for the single shortcut we need (Cmd/Ctrl+N), avoiding unnecessary dependencies.

Output: Confetti utility and keyboard shortcut hook ready for integration into quick capture and task completion flows.
</objective>

<execution_context>
@/home/rbrown/.claude/get-shit-done/workflows/execute-plan.md
@/home/rbrown/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-capture--and--feedback/02-RESEARCH.md
@frontend/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install canvas-confetti dependency</name>
  <files>frontend/package.json, frontend/package-lock.json</files>
  <action>
Install canvas-confetti for celebration animations:

```bash
cd frontend && npm install canvas-confetti && npm install -D @types/canvas-confetti
```

This is a lightweight (15KB) GPU-accelerated confetti library that works with any framework.

Verify installation by checking package.json includes canvas-confetti in dependencies.
  </action>
  <verify>
1. `grep "canvas-confetti" frontend/package.json` shows the dependency
2. `ls frontend/node_modules/canvas-confetti` exists
  </verify>
  <done>
canvas-confetti is installed as a dependency with TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create confetti utility with presets</name>
  <files>frontend/lib/confetti.ts</files>
  <action>
Create a confetti utility that wraps canvas-confetti with ADHD-friendly presets:

1. Generic triggerConfetti function with customizable options
2. triggerTaskComplete preset for task completion celebrations
3. Respect prefers-reduced-motion media query
4. Reasonable defaults (100 particles, spread 70, origin near center-bottom)

Implementation:
```typescript
import confetti from 'canvas-confetti'

// Check for reduced motion preference
const prefersReducedMotion = () => {
  if (typeof window === 'undefined') return false
  return window.matchMedia('(prefers-reduced-motion: reduce)').matches
}

// Generic confetti trigger with options
export function triggerConfetti(options?: confetti.Options): void {
  if (prefersReducedMotion()) return

  confetti({
    particleCount: 100,
    spread: 70,
    origin: { y: 0.6 },
    ...options
  })
}

// Preset for task completion - celebratory burst
export function triggerTaskComplete(): void {
  if (prefersReducedMotion()) return

  confetti({
    particleCount: 80,
    spread: 60,
    origin: { y: 0.7 },
    colors: ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6'], // Green, blue, amber, purple
    ticks: 200,
    gravity: 1.2,
    scalar: 1.1
  })
}

// Preset for quick capture success - subtle confirmation
export function triggerQuickCapture(): void {
  if (prefersReducedMotion()) return

  confetti({
    particleCount: 30,
    spread: 40,
    origin: { y: 0.5 },
    colors: ['#10b981', '#3b82f6'],
    ticks: 100,
    gravity: 1.5
  })
}
```

The colors match the app's semantic colors (success green, primary blue, warning amber).
  </action>
  <verify>
1. `npm run build` passes
2. `grep -r "triggerTaskComplete" frontend/lib/confetti.ts` shows export
3. `grep -r "prefers-reduced-motion" frontend/lib/confetti.ts` shows accessibility handling
  </verify>
  <done>
Confetti utility exists with triggerConfetti, triggerTaskComplete, and triggerQuickCapture exports, respecting reduced-motion preference.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create useKeyboardShortcut hook</name>
  <files>frontend/lib/hooks/useKeyboardShortcut.ts</files>
  <action>
Create a lightweight keyboard shortcut hook (simpler than react-hotkeys-hook since we only need one shortcut):

1. Listen for keydown events on document
2. Handle Cmd (Mac) / Ctrl (Windows/Linux) modifier detection
3. Call callback when shortcut matches
4. Clean up listener on unmount
5. Prevent default browser behavior (e.g., Ctrl+N opens new window)

Implementation:
```typescript
import { useEffect, useCallback } from 'react'

type Modifier = 'ctrl' | 'meta' | 'alt' | 'shift'

interface ShortcutConfig {
  key: string
  modifiers?: Modifier[]
  callback: () => void
  preventDefault?: boolean
}

export function useKeyboardShortcut({
  key,
  modifiers = [],
  callback,
  preventDefault = true
}: ShortcutConfig): void {
  const handleKeyDown = useCallback((event: KeyboardEvent) => {
    // Check if the key matches (case-insensitive)
    if (event.key.toLowerCase() !== key.toLowerCase()) return

    // Check modifiers
    const modifierChecks = {
      ctrl: event.ctrlKey || event.metaKey, // Treat Cmd same as Ctrl for cross-platform
      meta: event.metaKey,
      alt: event.altKey,
      shift: event.shiftKey
    }

    // For 'ctrl' modifier, accept either Ctrl or Cmd (cross-platform)
    const allModifiersMatch = modifiers.every(mod => {
      if (mod === 'ctrl') return event.ctrlKey || event.metaKey
      return modifierChecks[mod]
    })

    if (!allModifiersMatch) return

    // Don't trigger if user is typing in an input/textarea (unless it's our quick capture)
    const target = event.target as HTMLElement
    const isTyping = ['INPUT', 'TEXTAREA'].includes(target.tagName) &&
                     !target.closest('[data-quick-capture]')

    if (isTyping) return

    if (preventDefault) {
      event.preventDefault()
      event.stopPropagation()
    }

    callback()
  }, [key, modifiers, callback, preventDefault])

  useEffect(() => {
    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [handleKeyDown])
}

// Convenience export for the quick capture shortcut
export function useQuickCaptureShortcut(onTrigger: () => void): void {
  useKeyboardShortcut({
    key: 'n',
    modifiers: ['ctrl'],
    callback: onTrigger,
    preventDefault: true
  })
}
```

Note: The hook treats Ctrl and Cmd as equivalent for 'ctrl' modifier, enabling cross-platform compatibility.
  </action>
  <verify>
1. `npm run build` passes
2. `grep -r "useKeyboardShortcut" frontend/lib/hooks/` shows export
3. `grep -r "addEventListener.*keydown" frontend/lib/hooks/` shows event handling
4. `grep -r "removeEventListener" frontend/lib/hooks/` shows cleanup
  </verify>
  <done>
useKeyboardShortcut and useQuickCaptureShortcut hooks exist with cross-platform modifier handling, input field awareness, and proper cleanup.
  </done>
</task>

</tasks>

<verification>
1. canvas-confetti installed: `grep "canvas-confetti" frontend/package.json`
2. All utilities compile: `cd frontend && npm run build`
3. Confetti respects accessibility: `grep "reduced-motion" frontend/lib/confetti.ts`
4. Keyboard hook has cleanup: `grep "removeEventListener" frontend/lib/hooks/useKeyboardShortcut.ts`
</verification>

<success_criteria>
- canvas-confetti installed with types
- Confetti utility provides triggerTaskComplete and triggerQuickCapture
- Confetti respects prefers-reduced-motion accessibility setting
- Keyboard shortcut hook handles Cmd/Ctrl cross-platform
- Keyboard shortcut ignores input fields (except quick capture)
- All code builds without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-capture--and--feedback/02-02-SUMMARY.md`
</output>

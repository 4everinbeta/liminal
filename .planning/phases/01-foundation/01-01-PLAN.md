---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/smartDefaults.ts
  - frontend/components/TaskForm.tsx
  - frontend/lib/api.ts
autonomous: true

must_haves:
  truths:
    - "User can create task with title only"
    - "All other form fields are auto-filled with smart defaults"
    - "User can optionally expand form to see/modify additional fields"
    - "Priority/value/effort auto-calculated from due date + duration"
  artifacts:
    - path: "frontend/lib/smartDefaults.ts"
      provides: "Smart defaults calculation"
      exports: ["calculateSmartDefaults"]
    - path: "frontend/components/TaskForm.tsx"
      provides: "Progressive disclosure task form"
      contains: "showAdvanced"
  key_links:
    - from: "frontend/components/TaskForm.tsx"
      to: "frontend/lib/smartDefaults.ts"
      via: "import calculateSmartDefaults"
      pattern: "calculateSmartDefaults\\("
    - from: "frontend/components/TaskForm.tsx"
      to: "frontend/lib/api.ts"
      via: "createTask call"
      pattern: "createTask\\("
---

<objective>
Simplify task creation to title-only with smart auto-calculated defaults

Purpose: ADHD users abandon forms with multiple required fields. By requiring only title and auto-calculating priority/value/effort from urgency signals (due date, duration), we reduce capture friction from 4+ decisions to 1.

Output: A TaskForm component with progressive disclosure - title visible by default, optional fields hidden behind "Add details" toggle. Smart defaults utility that calculates scores based on ADHD-friendly urgency logic (NOW/NOT NOW).
</objective>

<execution_context>
@/home/rbrown/.claude/get-shit-done/workflows/execute-plan.md
@/home/rbrown/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md

# Existing files to modify
@frontend/components/TaskForm.tsx
@frontend/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create smart defaults utility</name>
  <files>frontend/lib/smartDefaults.ts</files>
  <action>
Create a new utility file `frontend/lib/smartDefaults.ts` that exports `calculateSmartDefaults(task: Partial<TaskCreate>): TaskCreate`.

Implementation logic (from 01-RESEARCH.md Pattern 2):
1. Accept partial task with optional fields (title, due_date, estimated_duration)
2. Auto-calculate priority_score based on urgency:
   - If due_date provided:
     - Due within 24 hours: priority_score = 90 (high)
     - Due within 72 hours: priority_score = 70 (medium-high)
     - Due within 7 days: priority_score = 50 (medium)
     - Due later: priority_score = 30 (low)
   - If no due_date: priority_score = 50 (medium default)
3. Derive priority label from score: high >= 67, medium >= 34, low < 34
4. Auto-calculate value_score based on duration (quick wins = high value):
   - Duration < 15 min: value_score = 90 (quick win)
   - Duration < 30 min: value_score = 70
   - Duration < 60 min: value_score = 50
   - Duration >= 60 min: value_score = 30
   - No duration: value_score = 50 (default)
5. Set effort_score = estimated_duration (or 30 if not provided)
6. Default status = 'backlog'

Export the function and the TaskCreate type re-export from api.ts for convenience.

Do NOT use external date libraries - use native Date math. The calculation is simple enough.
  </action>
  <verify>
- File exists at frontend/lib/smartDefaults.ts
- TypeScript compiles without errors: `cd /home/rbrown/workspace/liminal/frontend && npx tsc --noEmit`
- Function returns expected defaults: priority_score=90 for due today, value_score=90 for 10min duration
  </verify>
  <done>
calculateSmartDefaults utility exists and correctly auto-calculates priority/value/effort from due_date + estimated_duration following ADHD urgency logic (NOW/NOT NOW).
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor TaskForm to progressive disclosure with title-only default</name>
  <files>frontend/components/TaskForm.tsx</files>
  <action>
Refactor TaskForm.tsx to implement progressive disclosure pattern (from 01-RESEARCH.md Pattern 1):

1. **Initial state changes:**
   - Add `showAdvanced` state (boolean, default false)
   - Remove priority, estimated_duration, value_score from initial formData (only title needed)

2. **Form structure - collapsed (default):**
   - Show ONLY title input field
   - Add "Add details" button/link that toggles `showAdvanced`
   - Submit button creates task with smart defaults

3. **Form structure - expanded (when showAdvanced=true):**
   - Wrap additional fields in `<motion.div>` with animate height/opacity (use Framer Motion, already installed)
   - Show: due_date (date picker), estimated_duration (number), description (textarea)
   - Replace abstract 1-100 value_score/priority inputs with presets:
     - Priority: "Today" / "This Week" / "Later" buttons (map to 90/60/30)
     - Duration: "Quick (15m)" / "Medium (30m)" / "Long (60m)" / custom input
   - "Hide details" button to collapse

4. **Form submission:**
   - Import and use `calculateSmartDefaults` from '@/lib/smartDefaults'
   - Merge user input with smart defaults
   - Call createTask with merged data

5. **Styling:**
   - Keep existing Tailwind classes
   - Use `motion.div` with `initial={{ opacity: 0, height: 0 }}` and `animate={{ opacity: 1, height: 'auto' }}`
   - Add smooth transition (0.2s) for expand/collapse

Remove the explicit priority buttons from the default view. Users who need them can expand.

IMPORTANT: Keep the onTaskCreated callback prop and existing close/cancel behavior.
  </action>
  <verify>
- `npm run build` succeeds in frontend directory
- Form shows only title input by default
- "Add details" reveals due_date, duration, description fields
- Creating task with only title succeeds (smart defaults applied)
  </verify>
  <done>
TaskForm requires only title, shows progressive disclosure for optional fields, and auto-applies smart defaults on submission.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update parseQuickCapture to use smart defaults</name>
  <files>frontend/lib/api.ts</files>
  <action>
Update the `parseQuickCapture` function in api.ts to use the new smart defaults logic:

1. Import calculateSmartDefaults from './smartDefaults'
2. After parsing shorthand (p:, v:, e:, !high, etc.), pass the parsed values through calculateSmartDefaults
3. User-provided shorthand values should OVERRIDE smart defaults (not be overwritten)

Logic:
```typescript
export function parseQuickCapture(input: string): TaskCreate {
  // ... existing parsing logic for title, priority, duration, value ...

  // Apply smart defaults, then overlay user-specified values
  const baseDefaults = calculateSmartDefaults({ title, estimated_duration })

  return {
    ...baseDefaults,
    title,
    // Only override if user explicitly provided
    ...(priorityMatch || priorityNumMatch ? { priority, priority_score } : {}),
    ...(valueMatch ? { value_score } : {}),
    ...(timeMatch ? { estimated_duration, effort_score: estimated_duration } : {}),
  }
}
```

This ensures:
- "Write report" -> smart defaults apply (medium priority, medium value)
- "Write report !high" -> high priority from user, smart value
- "Write report v:90 30m" -> user-specified value and duration, smart priority from duration
  </action>
  <verify>
- TypeScript compiles: `cd /home/rbrown/workspace/liminal/frontend && npx tsc --noEmit`
- parseQuickCapture("test task") returns sensible smart defaults
- parseQuickCapture("test task !high") preserves user priority
  </verify>
  <done>
parseQuickCapture integrates with smart defaults - user shorthand overrides defaults, missing values auto-calculated.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Start frontend dev server: `cd /home/rbrown/workspace/liminal/frontend && npm run dev`
2. Navigate to dashboard
3. Click "Add New Task" - should show only title input
4. Enter "Test task" and submit - task created with auto-calculated scores
5. Click "Add New Task" again, click "Add details" - should expand to show due date, duration, description
6. Test quick capture in ChatInterface with "test task 15m !high" - should apply hybrid of user input and smart defaults
</verification>

<success_criteria>
- [ ] User can create task with title only (no other fields required)
- [ ] TaskForm shows progressive disclosure (title default, details on demand)
- [ ] Smart defaults auto-calculate priority from due_date urgency
- [ ] Smart defaults auto-calculate value from duration (quick wins = high value)
- [ ] Quick capture syntax still works and merges with smart defaults
- [ ] No TypeScript errors
- [ ] Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>

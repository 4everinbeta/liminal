---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - frontend/app/page.tsx
  - frontend/lib/store.ts
  - frontend/components/FocusToggle.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard shows one primary workflow (not chat + form + board competing)"
    - "Focus mode is the default view on first load"
    - "User can toggle between focus and planning views"
    - "View toggle preserves task context (active task, scroll position)"
    - "Pause button either works or is removed"
  artifacts:
    - path: "frontend/app/page.tsx"
      provides: "Unified dashboard with focus-first design"
      contains: "isFocusMode"
    - path: "frontend/lib/store.ts"
      provides: "Persisted focus mode state"
      contains: "partialize"
  key_links:
    - from: "frontend/app/page.tsx"
      to: "frontend/lib/store.ts"
      via: "useAppStore hook"
      pattern: "useAppStore\\("
    - from: "frontend/components/FocusToggle.tsx"
      to: "frontend/lib/store.ts"
      via: "toggleFocusMode action"
      pattern: "toggleFocusMode"
---

<objective>
Consolidate dashboard to single primary interface with focus mode as default

Purpose: Current dashboard shows competing interfaces (task list, chat, quick add form) creating choice paralysis for ADHD users. By making focus mode the default and consolidating secondary interfaces behind clear navigation, we reduce cognitive load and direct attention to execution.

Output: A dashboard that loads into focus mode by default, shows the current task prominently, and provides a clear toggle to "planning mode" where chat/form/list are accessible. Pause button either works functionally or is removed.
</objective>

<execution_context>
@/home/rbrown/.claude/get-shit-done/workflows/execute-plan.md
@/home/rbrown/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md

# Depends on Plan 01 for simplified TaskForm
@.planning/phases/01-foundation/01-01-SUMMARY.md

# Existing files to modify
@frontend/app/page.tsx
@frontend/lib/store.ts
@frontend/components/FocusToggle.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update store to persist focus mode and make it default true</name>
  <files>frontend/lib/store.ts</files>
  <action>
Modify the Zustand store to:

1. **Change isFocusMode default to true** (was false):
```typescript
isFocusMode: true, // Focus mode is now the default
```

2. **Add focus mode to persisted state** (currently only chatMessages is persisted):
```typescript
partialize: (state) => ({
  chatMessages: state.chatMessages,
  isFocusMode: state.isFocusMode, // Persist focus mode preference
  activeTaskId: state.activeTaskId, // Persist active task across sessions
}),
```

3. **Add scroll position tracking** for planning view:
```typescript
// Add to interface
planningScrollPosition: number
setPlanningScrollPosition: (pos: number) => void

// Add to create
planningScrollPosition: 0,
setPlanningScrollPosition: (pos) => set({ planningScrollPosition: pos }),
```

4. **Add to partialize** to persist scroll position:
```typescript
partialize: (state) => ({
  chatMessages: state.chatMessages,
  isFocusMode: state.isFocusMode,
  activeTaskId: state.activeTaskId,
  planningScrollPosition: state.planningScrollPosition,
}),
```

This ensures:
- New users start in focus mode (execution-first)
- Returning users resume their last mode preference
- Active task preserved across page reloads
- Scroll position preserved when toggling views
  </action>
  <verify>
- TypeScript compiles: `cd /home/rbrown/workspace/liminal/frontend && npx tsc --noEmit`
- store.ts exports isFocusMode with default true
- sessionStorage includes isFocusMode, activeTaskId, planningScrollPosition after toggle
  </verify>
  <done>
Store persists focus mode preference (default true), active task ID, and planning scroll position across sessions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restructure dashboard for focus-first with clear mode toggle</name>
  <files>frontend/app/page.tsx</files>
  <action>
Refactor page.tsx to implement focus-first design:

1. **Update imports** - add setPlanningScrollPosition from store

2. **Restructure header** to emphasize mode toggle:
```typescript
<header className="flex items-center justify-between py-4">
  <h1 className="text-2xl font-bold text-gray-900">Liminal</h1>
  <div className="flex items-center gap-3">
    {/* Mode toggle - prominent */}
    <div className="bg-gray-100 rounded-full p-1 flex">
      <button
        onClick={() => { /* set focus mode */ }}
        className={`px-4 py-2 rounded-full text-sm font-medium transition-colors ${
          isFocusMode ? 'bg-white shadow text-primary' : 'text-gray-500'
        }`}
      >
        Focus
      </button>
      <button
        onClick={() => { /* set planning mode */ }}
        className={`px-4 py-2 rounded-full text-sm font-medium transition-colors ${
          !isFocusMode ? 'bg-white shadow text-primary' : 'text-gray-500'
        }`}
      >
        Plan
      </button>
    </div>
    {/* Board link - secondary */}
    <a href="/board" className="text-sm text-gray-500 hover:text-primary">
      Board
    </a>
  </div>
</header>
```

3. **Focus Mode view** (when isFocusMode = true):
   - Keep existing focus mode content but make it THE primary view
   - Remove the "FocusToggle" component from within focus mode (header toggle handles it)
   - Simplify: current task, timer, complete/skip buttons (remove pause for now - see Task 3)

4. **Planning Mode view** (when isFocusMode = false):
   - Consolidate into SINGLE column layout instead of grid:
     - Quick add form at top (uses new progressive disclosure TaskForm from Plan 01)
     - Task list below
     - Chat assistant as collapsible sidebar or bottom panel (not competing with form)
   - Restore scroll position from store on mount:
```typescript
useEffect(() => {
  if (!isFocusMode) {
    window.scrollTo(0, planningScrollPosition)
  }
}, [isFocusMode])
```
   - Save scroll position before switching to focus mode:
```typescript
const handleSwitchToFocus = () => {
  setPlanningScrollPosition(window.scrollY)
  toggleFocusMode()
}
```

5. **Preserve active task context**:
   - When toggling from planning to focus, keep the same activeTaskId
   - If user clicks a task in planning mode, set it as activeTaskId
   - Focus mode shows that task

Remove the current competing 3-column layout. Planning mode should feel like preparation, focus mode like execution.
  </action>
  <verify>
- Page loads in focus mode by default
- Toggle switches between Focus and Plan views
- Planning view shows single-column layout with form, then tasks, then chat
- Switching back to planning restores scroll position
- Active task preserved when toggling
  </verify>
  <done>
Dashboard loads focus mode by default, provides clear Focus/Plan toggle, consolidates planning view to single column, preserves context on toggle.
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove non-functional pause button</name>
  <files>frontend/app/page.tsx</files>
  <action>
Remove the pause button stub that currently does nothing:

1. **Remove the pause button** from focus mode view:
```typescript
// DELETE this button:
// <button
//   onClick={handlePauseTask}
//   className="flex-1 py-4 bg-gray-50 text-gray-600 ..."
// >
//   <PauseCircle size={24} />
//   Pause
// </button>
```

2. **Remove handlePauseTask function** (lines ~98-103)

3. **Remove PauseCircle import** from lucide-react

4. **Adjust button layout** - Complete Task button now takes full width:
```typescript
<div className="w-full">
  <button
    onClick={() => handleCompleteTask(activeTask.id)}
    className="w-full py-4 bg-green-50 text-green-700 hover:bg-green-100 rounded-2xl font-bold flex items-center justify-center gap-2 transition-colors text-lg"
  >
    <CheckCircle size={24} />
    Complete Task
  </button>
</div>
```

5. **Add "Skip to Next" as alternative** (optional but helpful):
```typescript
<div className="flex gap-4 w-full">
  <button
    onClick={() => handleCompleteTask(activeTask.id)}
    className="flex-1 py-4 bg-green-50 text-green-700 hover:bg-green-100 rounded-2xl font-bold flex items-center justify-center gap-2 transition-colors text-lg"
  >
    <CheckCircle size={24} />
    Complete
  </button>
  <button
    onClick={() => {
      // Move to next task without completing
      const currentIndex = tasks.findIndex(t => t.id === activeTaskId)
      const nextTask = tasks[currentIndex + 1] || tasks[0]
      if (nextTask && nextTask.id !== activeTaskId) setActiveTaskId(nextTask.id)
    }}
    className="flex-1 py-4 bg-gray-50 text-gray-600 hover:bg-gray-100 rounded-2xl font-bold flex items-center justify-center gap-2 transition-colors text-lg"
  >
    <ArrowRight size={24} />
    Skip
  </button>
</div>
```

Import ArrowRight from lucide-react if adding Skip button.

Rationale: Pause is confusing without clear semantics. "Skip" is concrete - move to next task. Users can return to skipped tasks later.
  </action>
  <verify>
- Focus mode shows Complete and Skip buttons (no Pause)
- Complete marks task done and advances
- Skip moves to next task without completing
- No console errors about handlePauseTask
  </verify>
  <done>
Pause button removed. Focus mode shows Complete (marks done) and Skip (next task) - clear, actionable options.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Clear sessionStorage to test fresh user experience
2. Load dashboard - should show focus mode with current task
3. Toggle to Plan mode - should show single-column layout with form, tasks, chat
4. Scroll down in planning mode, toggle to Focus, toggle back - scroll restored
5. Click a task in planning mode, toggle to Focus - that task should be active
6. In focus mode: Complete task - advances to next
7. In focus mode: Skip task - moves to next without completing
</verification>

<success_criteria>
- [ ] Dashboard loads in focus mode by default (isFocusMode: true)
- [ ] Clear Focus/Plan toggle in header
- [ ] Planning view is single-column (form, tasks, chat) not competing grid
- [ ] Context preserved on toggle (active task, scroll position)
- [ ] Pause button removed
- [ ] Complete and Skip buttons work correctly
- [ ] No TypeScript errors, build succeeds
</success_criteria>

<checkpoint type="human-verify">
  <what-built>Complete Phase 1 Foundation - simplified forms, frictionless board, focus-first dashboard</what-built>
  <how-to-verify>
1. Open http://localhost:3000 (frontend dev server)
2. Verify focus mode loads by default with active task
3. Toggle to Plan mode - verify single column layout
4. Create new task with title only - verify it works
5. Go to /board - drag incomplete task between columns - verify no modal
6. Toggle back to Focus mode - verify context preserved
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues found</resume-signal>
</checkpoint>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
